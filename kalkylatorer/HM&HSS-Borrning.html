<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skärdatakalkylator - Borrning (HM & HSS)</title>
    <style>
        /* Modern CSS för Mobilanpassning - Corporate Blue Theme */
        :root {
            --primary-color: #004085; /* Deep Corporate Blue */
            --secondary-color: #17a2b8; /* Sharp Teal/Cyan for Results Highlight */
            --accent-color: #ffc107;
            --background-color: #f8f9fa; /* Light, neutral body background */
            --card-background: #ffffff;
            --text-color: #343a40;
            --border-color: #ced4da; /* Sharper, slightly darker border */
            --warning-color: #dc3545;
            --hm-color: #004085; /* Use primary blue for HM indicator */
            --hss-color: #e99400; /* Distinct HSS Orange */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            padding: 20px 10px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: var(--card-background);
            padding: 25px;
            border-radius: 6px; /* Skarpare hörn */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); /* Tydligare skugga */
        }

        h1 {
            color: var(--primary-color);
            font-size: 1.8em;
            text-align: center;
            margin-bottom: 5px;
            font-weight: 700;
            border-bottom: 2px solid var(--border-color); /* Tydlig separation */
            padding-bottom: 15px;
        }

        .info-text {
            font-size: 0.85em;
            text-align: center;
            color: #6c757d;
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-top: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary-color); /* Blå labels */
        }

        select, input[type="number"] {
            width: 100%;
            padding: 14px 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px; /* Skarpa hörn på inputs */
            box-sizing: border-box;
            font-size: 1em;
            appearance: none; 
            background-color: #ffffff;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        select:focus, input[type="number"]:focus {
            border-color: var(--secondary-color); /* Teal-fokus */
            box-shadow: 0 0 0 4px rgba(23, 162, 184, 0.25); /* Tydlig fokus-skugga */
            background-color: var(--card-background);
            outline: none;
        }

        /* Resultatsektionens design */
        .results {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid var(--secondary-color);
            background-color: #f0f8ff; /* Mycket ljusblå bakgrund för resultat */
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .results h2 {
            font-size: 1.4em;
            color: var(--primary-color);
            margin-top: 0;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .results p {
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            line-height: 1.5;
        }

        .results strong {
            font-weight: 700;
        }

        .results span {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .sub-value {
            font-size: 0.85em;
            margin-left: 15px;
            color: #6c757d;
        }
        .warning {
            color: var(--warning-color);
            font-weight: 600;
            padding: 10px;
            border: 1px solid var(--warning-color);
            border-radius: 5px;
            margin-top: 15px;
            text-align: center;
        }
        .capped-rpm {
            color: var(--warning-color);
            font-weight: bold;
        }
        .tool-indicator {
            font-size: 0.8em;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: auto;
        }
        .tool-indicator-hm {
            background-color: var(--hm-color);
            color: white;
        }
        .tool-indicator-hss {
            background-color: var(--hss-color);
            color: white;
        }
        
    </style>
</head>
<body>

<div class="container">
    <h1>Metrisk Skärdatakalkylator</h1>
    <p class="info-text">*Använder säkra startvärden för HM/HSS borr (0.5 - 25.0 mm).</p>
    
    <div class="input-group">
        <label for="toolType">Välj Verktygsmaterial:</label>
        <select id="toolType">
            <option value="HM">Hårdmetall (HM)</option>
            <option value="HSS">Snabbstål (HSS) - Balanserade Värden</option>
        </select>
    </div>

    <div class="input-group">
        <label for="material">Välj Material:</label>
        <select id="material">
            <option value="">-- Välj material... --</option>
            <option value="mjukt_stal">Stål: Mjukt (< 1100 N/mm²)</option>
            <option value="hart_stal">Stål: Hårt (> 1100 N/mm²)</option>
            <option value="rostfritt_austenit">Rostfritt: Austenitiskt (< 850 N/mm²)</option>
            <option value="toolox_44">Stål: Toolox 44 (< 50 HRC)</option>
            <option value="hardat_stal_65">Stål: Härdat (<65HRC)</option>
            <option value="aluminium">Aluminium</option>
            <option value="koppar">Koppar</option>
        </select>
    </div>

    <div class="input-group">
        <label for="length">Välj Borrlängd (L/D):</label>
        <select id="length">
            <option value="">-- Välj längd... --</option>
            <option value="3xD">3xD</option>
            <option value="5xD">5xD</option>
            <option value="8xD">8xD</option>
            <option value="10xD">10xD</option>
            <option value="12xD">12xD</option>
            <option value="15xD">15xD</option>
        </select>
    </div>

    <div class="input-group">
        <label for="diameter">Borrdiameter D (mm, 0.5 - 25.0):</label>
        <input type="number" id="diameter" step="0.1" min="0.5" max="25.0" placeholder="Ange diameter (ex. 4.3)">
    </div>
    
    <div class="input-group">
        <label for="maxRpm">Maskinens Max RPM (Valfritt):</label>
        <input type="number" id="maxRpm" step="1" min="1" placeholder="Max varvtal (t.ex. 12000)">
    </div>
    
    <div class="results" id="results">
        <p class="warning">Fyll i Verktyg, Material, Längd och Diameter för att beräkna skärdata.</p>
    </div>
</div>

<script>
    // --- Materialdata för HM och HSS (Vc och Fm) ---
    const materialDataHM = {
        "mjukt_stal": { name: "Stål: Mjukt (< 1100 N/mm²)", Fm: 1.0, Vc_safe: 60 },
        "hart_stal": { name: "Stål: Hårt (> 1100 N/mm²)", Fm: 0.9, Vc_safe: 40 },
        "toolox_44": { name: "Stål: Toolox 44 (< 50 HRC)", Fm: 0.7, Vc_safe: 20 },
        "rostfritt_austenit": { name: "Rostfritt: Austenitiskt (< 850 N/mm²)", Fm: 0.9, Vc_safe: 30 }, 
        "hardat_stal_65": { name: "Stål: Härdat (<65HRC)", Fm: 0.6, Vc_safe: 15 },
        "aluminium": { name: "Aluminium", Fm: 1.4, Vc_safe: 200 },
        "koppar": { name: "Koppar", Fm: 1.0, Vc_safe: 80 }
    };
    
    const materialDataHSS = {
        "mjukt_stal": { name: "Stål: Mjukt (< 1100 N/mm²)", Fm: 1.0, Vc_safe: 20 },
        "hart_stal": { name: "Stål: Hårt (> 1100 N/mm²)", Fm: 0.9, Vc_safe: 15 },
        "toolox_44": { name: "Stål: Toolox 44 (< 50 HRC)", Fm: 0.7, Vc_safe: 10 },
        "rostfritt_austenit": { name: "Rostfritt: Austenitiskt (< 850 N/mm²)", Fm: 0.8, Vc_safe: 12 }, 
        "hardat_stal_65": { name: "Stål: Härdat (<65HRC)", Fm: 0.6, Vc_safe: 5 },
        "aluminium": { name: "Aluminium", Fm: 1.4, Vc_safe: 60 },
        "koppar": { name: "Koppar", Fm: 1.0, Vc_safe: 30 }
    };

    // --- Diameterfaktor (Fd) för Hårdmetall (HM) (Från PDF & Extrapolerad) ---
    const FdTableHM = [
        { D: 0.5, '3xD': 0.05, '5xD': 0.04, '8xD': 0.035, '10xD': 0.032, '12xD': 0.030, '15xD': 0.025 },
        { D: 1.0, '3xD': 0.07, '5xD': 0.055, '8xD': 0.045, '10xD': 0.040, '12xD': 0.035, '15xD': 0.030 },
        { D: 2.0, '3xD': 0.09, '5xD': 0.075, '8xD': 0.065, '10xD': 0.060, '12xD': 0.055, '15xD': 0.050 },
        { D: 2.5, '3xD': 0.11, '5xD': 0.09, '8xD': 0.075, '10xD': 0.070, '12xD': 0.065, '15xD': 0.055 },
        { D: 3.0, '3xD': 0.12, '5xD': 0.10, '8xD': 0.08, '10xD': 0.075, '12xD': 0.07, '15xD': 0.06 },
        { D: 4.0, '3xD': 0.14, '5xD': 0.11, '8xD': 0.10, '10xD': 0.095, '12xD': 0.09, '15xD': 0.08 },
        { D: 5.0, '3xD': 0.17, '5xD': 0.14, '8xD': 0.12, '10xD': 0.11, '12xD': 0.10, '15xD': 0.09 },
        { D: 6.0, '3xD': 0.20, '5xD': 0.16, '8xD': 0.14, '10xD': 0.12, '12xD': 0.11, '15xD': 0.10 },
        { D: 8.0, '3xD': 0.26, '5xD': 0.21, '8xD': 0.18, '10xD': 0.16, '12xD': 0.14, '15xD': 0.12 },
        { D: 10.0, '3xD': 0.34, '5xD': 0.27, '8xD': 0.24, '10xD': 0.22, '12xD': 0.20, '15xD': 0.18 },
        { D: 12.0, '3xD': 0.38, '5xD': 0.30, '8xD': 0.27, '10xD': 0.25, '12xD': 0.23, '15xD': 0.20 },
        { D: 14.0, '3xD': 0.41, '5xD': 0.33, '8xD': 0.29, '10xD': 0.27, '12xD': 0.25, '15xD': 0.22 },
        { D: 16.0, '3xD': 0.44, '5xD': 0.35, '8xD': 0.31, '10xD': 0.29, '12xD': 0.27, '15xD': 0.24 },
        { D: 18.0, '3xD': 0.46, '5xD': 0.37, '8xD': 0.32, '10xD': 0.30, '12xD': 0.28, '15xD': 0.25 },
        { D: 20.0, '3xD': 0.50, '5xD': 0.40, '8xD': 0.35, '10xD': 0.32, '12xD': 0.30, '15xD': 0.27 },
        { D: 22.0, '3xD': 0.53, '5xD': 0.42, '8xD': 0.37, '10xD': 0.34, '12xD': 0.32, '15xD': 0.29 },
        { D: 25.0, '3xD': 0.58, '5xD': 0.46, '8xD': 0.40, '10xD': 0.36, '12xD': 0.33, '15xD': 0.28 }
    ];

    // --- Diameterfaktor (Fd) för Snabbstål (HSS) (Nya, Balanserade Värden) ---
    const FdTableHSS = [
        // D-värden | 3xD (Bas) | 5xD (-30%) | 8xD (-40%) | 10xD (-45%) | 12xD (-50%) | 15xD (-60%)
        { D: 0.5, '3xD': 0.040, '5xD': 0.028, '8xD': 0.024, '10xD': 0.022, '12xD': 0.020, '15xD': 0.016 },
        { D: 1.0, '3xD': 0.045, '5xD': 0.031, '8xD': 0.027, '10xD': 0.025, '12xD': 0.022, '15xD': 0.018 },
        { D: 2.0, '3xD': 0.060, '5xD': 0.042, '8xD': 0.036, '10xD': 0.033, '12xD': 0.030, '15xD': 0.024 },
        { D: 2.5, '3xD': 0.070, '5xD': 0.049, '8xD': 0.042, '10xD': 0.038, '12xD': 0.035, '15xD': 0.028 },
        { D: 3.0, '3xD': 0.075, '5xD': 0.052, '8xD': 0.045, '10xD': 0.041, '12xD': 0.037, '15xD': 0.030 },
        { D: 4.0, '3xD': 0.11, '5xD': 0.08, '8xD': 0.07, '10xD': 0.06, '12xD': 0.05, '15xD': 0.04 },
        { D: 5.0, '3xD': 0.13, '5xD': 0.10, '8xD': 0.08, '10xD': 0.07, '12xD': 0.06, '15xD': 0.05 },
        { D: 6.0, '3xD': 0.16, '5xD': 0.12, '8xD': 0.10, '10xD': 0.08, '12xD': 0.07, '15xD': 0.06 },
        { D: 8.0, '3xD': 0.200, '5xD': 0.140, '8xD': 0.120, '10xD': 0.110, '12xD': 0.100, '15xD': 0.080 },
        { D: 10.0, '3xD': 0.230, '5xD': 0.161, '8xD': 0.138, '10xD': 0.126, '12xD': 0.115, '15xD': 0.092 },
        { D: 12.0, '3xD': 0.280, '5xD': 0.196, '8xD': 0.168, '10xD': 0.154, '12xD': 0.140, '15xD': 0.112 },
        { D: 14.0, '3xD': 0.310, '5xD': 0.217, '8xD': 0.186, '10xD': 0.170, '12xD': 0.155, '15xD': 0.124 },
        { D: 16.0, '3xD': 0.330, '5xD': 0.231, '8xD': 0.198, '10xD': 0.181, '12xD': 0.165, '15xD': 0.132 },
        { D: 18.0, '3xD': 0.350, '5xD': 0.245, '8xD': 0.210, '10xD': 0.192, '12xD': 0.175, '15xD': 0.140 },
        { D: 20.0, '3xD': 0.370, '5xD': 0.259, '8xD': 0.222, '10xD': 0.203, '12xD': 0.185, '15xD': 0.148 },
        { D: 22.0, '3xD': 0.380, '5xD': 0.266, '8xD': 0.228, '10xD': 0.209, '12xD': 0.190, '15xD': 0.152 },
        { D: 25.0, '3xD': 0.380, '5xD': 0.266, '8xD': 0.228, '10xD': 0.209, '12xD': 0.190, '15xD': 0.152 }
    ];

    /**
     * Linjär interpolering för Fd.
     */
    function interpolateFd(D, lengthType, toolType) {
        const FdTable = (toolType === 'HM') ? FdTableHM : FdTableHSS;
        
        if (D < 0.5) D = 0.5;
        if (D > 25.0) D = 25.0;

        let lower = FdTable.slice().reverse().find(item => item.D <= D);
        let upper = FdTable.find(item => item.D > D);

        if (!upper || lower.D === D) return lower[lengthType];
        if (!lower) return upper[lengthType];

        let D1 = lower.D;
        let Fd1 = lower[lengthType];
        let D2 = upper.D;
        let Fd2 = upper[lengthType];

        let interpolatedFd = Fd1 + (Fd2 - Fd1) * ((D - D1) / (D2 - D1));
        return parseFloat(interpolatedFd.toFixed(4));
    }

    /**
     * Beräknar och visar skärdata automatiskt.
     */
    function calculateCuttingData() {
        // Hämta element och värden
        const toolType = document.getElementById('toolType').value;
        const materialKey = document.getElementById('material').value;
        const lengthType = document.getElementById('length').value;
        const diameterInput = document.getElementById('diameter').value;
        const maxRpmInput = document.getElementById('maxRpm').value;
        const resultsDiv = document.getElementById('results');
        
        resultsDiv.innerHTML = ''; 

        // FIX FÖR MOBIL/PWA: Ersätter kommatecken med punkt för korrekt tolkning
        const D = parseFloat(diameterInput.replace(',', '.'));
        const maxRpm = parseFloat(maxRpmInput.replace(',', '.'));
        
        // Välj rätt datakälla (HM eller HSS)
        const currentMaterialData = (toolType === 'HM') ? materialDataHM : materialDataHSS;
        
        // 1. Validering: Kontrollera att Material, Längd och Diameter är ifyllda och giltiga
        if (!materialKey || !lengthType || isNaN(D) || D < 0.5 || D > 25.0) {
            resultsDiv.innerHTML = '<p class="warning">Fyll i Verktyg, Material, Längd och Diameter för att beräkna skärdata.</p>';
            return;
        }

        const material = currentMaterialData[materialKey];
        
        // 2. Beräkningar (Baserat på Vc)
        const Fm = material.Fm; 
        const Vc_safe = material.Vc_safe; 
        
        // Hämta Fd baserat på VALT VERKTYG
        const Fd = interpolateFd(D, lengthType, toolType);
        
        // Fn (fz) = Fm * Fd
        const Fn = Fm * Fd;
        
        // Beräknat varvtal baserat på Vc
        const n_calculated = (Vc_safe * 1000) / (Math.PI * D);
        
        let n_final = Math.round(n_calculated);
        let Vf_final;
        let rpmCapped = false;
        
        // 3. Max RPM-logik
        if (!isNaN(maxRpm) && maxRpm > 0 && n_calculated > maxRpm) {
            n_final = Math.round(maxRpm); // Begränsa varvtalet
            Vf_final = Fn * n_final; // Justera matningen för att behålla Fn
            rpmCapped = true;
        } else {
            // Använd det beräknade Vf om det inte begränsas av Max RPM
            Vf_final = Fn * n_calculated;
        }

        Vf_final = Math.round(Vf_final);
        
        // 4. Visa resultat
        let rpmDisplay = `<span>${n_final} varv/min</span>`;
        let vfDisplay = `<span>${Vf_final} mm/min</span>`;
        let rpmWarning = '';
        let toolIndicator = `<div class="tool-indicator tool-indicator-${toolType.toLowerCase()}">${toolType} Verktyg</div>`;

        if (rpmCapped) {
            rpmDisplay = `<span class="capped-rpm">${n_final} varv/min *</span>`;
            rpmWarning = `<p class="sub-value warning">*) Varvtal begränsat av din Max RPM. Bordmatning (Vf) har justerats nedåt för att bibehålla skärdata.</p>`;
        }

        resultsDiv.innerHTML = `
            <h2>SKÄRDATA ${toolIndicator}</h2>
            
            <p><strong>Varvtal (n)</strong> ${rpmDisplay}</p>
            <p><strong>Bordmatning (Vf)</strong> ${vfDisplay}</p>
            ${rpmWarning}
            <hr style="border-color: var(--border-color);">
            
            <p class="sub-value"><strong>Material:</strong> ${material.name} (${lengthType})</p>
            <p class="sub-value"><strong>Matning / varv (fz/Fn):</strong> ${Fn.toFixed(3)} mm/varv</p>
            <p class="sub-value"><strong>Skärhastighet (Vc):</strong> ${Vc_safe} m/min (Säkerhetsvärde)</p>
            <p class="sub-value"><strong>Diameterfaktor (Fd):</strong> ${Fd.toFixed(4)}</p>
        `;
    }

    // Lägg till händelselyssnare för automatisk uppdatering
    document.getElementById('toolType').addEventListener('change', calculateCuttingData);
    document.getElementById('material').addEventListener('change', calculateCuttingData);
    document.getElementById('length').addEventListener('change', calculateCuttingData);
    // Modifierade lyssnare för att hantera mobil input
    document.getElementById('diameter').addEventListener('input', calculateCuttingData);
    document.getElementById('maxRpm').addEventListener('input', calculateCuttingData); 

    // Kör en initial beräkning vid laddning
    document.addEventListener('DOMContentLoaded', calculateCuttingData);
</script>

</body>
</html>
