<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chamfer Milling Calculator Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css"> 
</head>
<body>
<div class="container">
    <button class="theme-toggle" id="themeToggle">ðŸŒ™</button>
    <div class="tool-badge tool-hm">HM</div>
   
    <header>
        <h1>Chamfer Milling Calculator Pro</h1>
        <h2 class="header-subtext">Cutting Data for Chamfer Milling based on Effective Diameter (D<sub>eff</sub>)</h2> 
    </header>
    <main>
        <div class="section-title">Geometry & Material</div>
        
        <div class="form-group">
            <label for="material">1. Material:</label>
            <select id="material">
                <option value="steel1080" selected>Steel (~1080 N/mmÂ²)</option>
                <option value="toolox44">Toolox 44 (~45 HRC)</option>
                <option value="steel50hrc">Hardened Steel 50 HRC</option>
                <option value="steel60hrc">Hardened Steel 60 HRC</option>
                <option value="vanadis">Vanadis / Powder Steel</option>
                <option value="nonferrous">Aluminum / Copper</option>
            </select>
        </div>

        <div class="form-group">
            <label for="Dtip">2. Tip Diameter D<sub>tip</sub> [mm]:</label>
            <select id="Dtip">
                <option value="0.0" selected>0.0 mm (Pointed)</option>
                <option value="0.5">0.5 mm</option>
                <option value="1.0">1.0 mm</option>
                <option value="2.0">2.0 mm</option>
                <option value="3.0">3.0 mm</option>
                <option value="5.0">5.0 mm</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="fasVinkel">3. Chamfer Angle Î¸ [Â°]:</label>
            <select id="fasVinkel">
                <option value="30">30Â°</option>
                <option value="45" selected>45Â°</option>
                <option value="60">60Â°</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="fasDjup">4. Chamfer Depth a<sub>p</sub> [mm] (Axial depth of cut):</label>
            <input type="number" id="fasDjup" value="1.0" step="0.1" min="0.1">
        </div>

        <hr>
        <div class="section-title">Cutting Data (Editable)</div>
        <div class="form-group"><label>Cutting Speed Vc [m/min]:</label><input type="number" id="vc" value="150" step="any"></div>
        <div class="form-group"><label>Base Feed Per Tooth f<sub>z,bas</sub> [mm/z]:</label><input type="number" id="fzBase" value="0.032" step="any"></div>
        <div class="form-group"><label>Number of Flutes z:</label><input type="number" id="z" value="4" step="1"></div>
        <div class="form-group"><label>Max RPM:</label><input type="number" id="maxRpm" value="8000" step="any"></div>
        
        
        <div class="results ready">
            <h2>Results</h2>
            <div class="result-line"><strong>Spindle Speed N [rpm]:</strong> <span class="value" id="nResult">-</span></div>
            <div class="result-line"><strong>V<sub>f</sub> (Internal/Std) [mm/min]:</strong> <span class="value" id="vfResultStandard">-</span></div>
            <div class="result-line"><strong>V<sub>f</sub> (External/Prod) [mm/min]:</strong> <span class="value capped" id="vfResultProd">-</span></div>
            
            <div class="details-box">
                <p><strong>D<sub>eff</sub>:</strong><span id="dEffResult">-</span></p> 
                <p><strong>Std. f<sub>z</sub>:</strong><span id="fzCorrectedStandard">-</span></p>
                <p><strong>Prod. f<sub>z</sub> (Std. f<sub>z</sub> * 1.5):</strong><span id="fzCorrectedProd">-</span></p>
                <p><strong>Feed Reduction R<sub>f</sub>:</strong><span id="rfFactorResult">-</span></p>
                <p><strong>Vc:</strong><span id="actualVcResult">-</span></p> 
            </div>
        </div>
    </main>
</div>
<footer>Chamfer Milling Calculator Pro â€“ created by Jimmy Rauhala</footer>

<script src="Chamfer_tool_data.js"></script>

<script>
    // =====================================================================
    // Kritiska HjÃ¤lpfunktioner
    // =====================================================================

    const parseValue = (id, defaultValue = 0) => {
        const value = parseFloat(document.getElementById(id).value);
        return isNaN(value) ? defaultValue : value;
    };
    
    const formatDecimal = (num, fixed) => {
        if (isNaN(num)) return "N/A";
        return num.toFixed(fixed).replace(/\.?0+$/, "");
    };


    // Flaggar fÃ¶r att kontrollera om anvÃ¤ndaren har redigerat Vc, fz, eller z manuellt
    const userEdited = {vc: false, fz: false, z: false};

    // Funktion fÃ¶r att uppdatera alla resultat i HTML-grÃ¤nssnittet
    function updateResults(n, Vf_standard, Vf_prod, D_eff, fz_korr_standard, fz_korr_prod, Rf_standard, Vc, maxRpm, isCapped, actualVc) {
        document.getElementById('nResult').textContent = Math.round(n);
        document.getElementById('vfResultStandard').textContent = Vf_standard;
        document.getElementById('vfResultProd').textContent = Vf_prod; 
        
        // SÃ¤tter fÃ¤rg pÃ¥ varvtalet om det begrÃ¤nsats av Max RPM
        document.getElementById('nResult').classList.toggle('capped', isCapped);
        
        // Uppdaterar detaljboxen
        document.getElementById('dEffResult').innerHTML = formatDecimal(D_eff, 3) + ' <sub>mm</sub>';
        document.getElementById('fzCorrectedStandard').innerHTML = formatDecimal(fz_korr_standard, 4) + ' <sub>mm/z</sub>';
        document.getElementById('fzCorrectedProd').innerHTML = formatDecimal(fz_korr_prod, 4) + ' <sub>mm/z</sub>';
        document.getElementById('rfFactorResult').innerHTML = formatDecimal(Rf_standard, 2) + ' <sub>(x)</sub>';
        
        // VISAR DET FAKTISKA Vc-VÃ„RDET
        document.getElementById('actualVcResult').innerHTML = formatDecimal(actualVc, 1) + ' <sub>m/min</sub>';
    }

    // HuvudberÃ¤kningsfunktion som anropar logiken i Chamfer_tool_data.js
    function calculate() {
        // HÃ¤mta inmatningsvÃ¤rden frÃ¥n HTML via parseValue()
        const D_tip = parseValue('Dtip');
        const fasVinkel = parseValue('fasVinkel');
        const ap = parseValue('fasDjup');
        const Vc = parseValue('vc');
        const fz_bas = parseValue('fzBase'); 
        const z = Math.round(parseValue('z', 1));
        const maxRpm = parseValue('maxRpm');
        const mat = document.getElementById('material').value;

        // Kontrollerar om nÃ¶dvÃ¤ndiga vÃ¤rden finns. 
        if (D_tip < 0 || ap <= 0 || Vc <= 0 || z <= 0 || fz_bas <= 0 || typeof runCalculations === 'undefined') {
            // Rensa resultat om inmatning saknas eller om JS-filen inte laddades
            const results = ['nResult', 'vfResultStandard', 'vfResultProd', 'dEffResult', 'fzCorrectedStandard', 'fzCorrectedProd', 'rfFactorResult', 'actualVcResult'];
            results.forEach(id => document.getElementById(id).textContent = 'N/A');
            document.getElementById('nResult').classList.remove('capped');
            return;
        }

        // Anropar berÃ¤kningslogiken (funktionalitet frÃ¥n Chamfer_tool_data.js)
        const results = runCalculations(D_tip, fasVinkel, ap, Vc, fz_bas, z, maxRpm, mat);

        // Uppdaterar grÃ¤nssnittet
        updateResults(
            results.n, 
            results.Vf_standard, 
            results.Vf_prod, 
            results.D_eff, 
            results.fz_korr_standard, 
            results.fz_korr_prod, 
            results.Rf_standard, 
            Vc, 
            maxRpm, 
            results.isCapped,
            results.actualVc
        );
    }
    
    // Funktion fÃ¶r att uppdatera Vc och fz baserat pÃ¥ materialval. Anropar calculate.
    function updateStandardValuesAndCalculate() {
        // Kontrollerar att beroenden frÃ¥n Chamfer_tool_data.js Ã¤r definierade
        if (typeof toolData === 'undefined' || typeof getFzFromTable === 'undefined' || typeof calculateDeff === 'undefined') {
             console.error("Chamfer_tool_data.js verkar inte ha laddats korrekt.");
             calculate(); 
             return;
        }

        const mat = document.getElementById('material').value;
        const matData = toolData[mat];
        
        if (!matData) return;
        
        // HÃ¤mta aktuella geometrivÃ¤rden
        const current_Dtip = parseValue('Dtip');
        const current_fasVinkel = parseValue('fasVinkel');
        const current_ap = parseValue('fasDjup');
        
        // BerÃ¤kna den aktuella D_eff och anvÃ¤nd den fÃ¶r att slÃ¥ upp fz.
        const actual_D_eff = calculateDeff(current_Dtip, current_fasVinkel, current_ap); 
        const default_fz = getFzFromTable(mat, actual_D_eff);
        
        // Uppdatera Vc, fzBase och z endast om anvÃ¤ndaren INTE redigerat dem
        if (!userEdited.vc) document.getElementById('vc').value = matData.vc;
        if (!userEdited.fz) document.getElementById('fzBase').value = formatDecimal(default_fz, 4);
        if (!userEdited.z) document.getElementById('z').value = matData.z_base;
        
        calculate();
    }


    // Huvudfunktion som kÃ¶rs nÃ¤r sidan laddas
    document.addEventListener('DOMContentLoaded', () => {
        // Event listeners fÃ¶r att markera om anvÃ¤ndaren redigerat ett vÃ¤rde
        document.querySelectorAll('input, select').forEach(el => el.addEventListener('input', () => {
            if (el.id === 'vc') userEdited.vc = true;
            if (el.id === 'fzBase') userEdited.fz = true;
            if (el.id === 'z') userEdited.z = true;
            calculate(); // KÃ¶r berÃ¤kningen vid varje inmatningsÃ¤ndring
        }));
        
        // Event listeners fÃ¶r Ã¤ndringar i input
        document.getElementById('material').addEventListener('change', updateStandardValuesAndCalculate);
        document.getElementById('Dtip').addEventListener('change', updateStandardValuesAndCalculate);
        document.getElementById('fasVinkel').addEventListener('change', updateStandardValuesAndCalculate);
        document.getElementById('fasDjup').addEventListener('input', updateStandardValuesAndCalculate); 
        document.getElementById('maxRpm').addEventListener('input', calculate);

        // Initial berÃ¤kning nÃ¤r sidan laddats
        updateStandardValuesAndCalculate();
    });

    // Dark Mode Toggle Logic
    const toggle = document.getElementById('themeToggle');
    const updateThemeIcon = () => {
        if (document.body.classList.contains('dark')) {
            toggle.textContent = 'â˜€ï¸';
        } else {
            toggle.textContent = 'ðŸŒ™';
        }
    };
    toggle.addEventListener('click', () => {
        document.body.classList.toggle('dark');
        updateThemeIcon();
    });
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
    updateThemeIcon();
</script>
</body>
</html>