<!DOCTYPE html>
<html lang="sv">
<head>
<link rel="manifest" href="manifest.json">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Min Sk√§rdataplattform (PWA)</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Gemensam Styling (Flyttad fr√•n kalkylatorerna) --- */
        :root {
            --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --text-light: #64748b;
            --primary: #3b82f6; --success: #10b981; --warning: #f59e0b; --danger: #ef4444;
            --border: #e2e8f0; --shadow: 0 20px 40px rgba(0,0,0,0.08); --radius: 16px;
            /* Extra f√§rger f√∂r borrning/fr√§sning */
            --tool-hm: #1d4ed8; 
            --tool-hss: #ea580c;
        }
        @media (prefers-color-scheme: dark) {
            :root { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --text-light: #94a3b8;
                    --border: #334155; --shadow: 0 20px 40px rgba(0,0,0,0.4); }
        }
        body.dark { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --text-light: #94a3b8;
                    --border: #334155; --shadow: 0 20px 40px rgba(0,0,0,0.4); }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Inter',sans-serif; background:var(--bg); color:var(--text);
               min-height:100vh; padding:20px 0; transition:all .4s; }
        
        /* --- Huvudcontainer & Flikar --- */
        .app-container { max-width:560px; margin:40px auto; background:var(--card);
                     border-radius:var(--radius); overflow:hidden; box-shadow:var(--shadow);
                     position:relative; }
        .theme-toggle { position:absolute; top:16px; right:16px; background:none; border:none;
                        font-size:1.5rem; cursor:pointer; padding:8px; border-radius:50%;
                        z-index: 10; color: var(--text-light); }
        .theme-toggle:hover { background:rgba(0,0,0,.1); }
        .tab-navigation { display: flex; justify-content: space-around; padding: 12px 16px; 
                          background: var(--bg); border-bottom: 1px solid var(--border); }
        .tab-btn { flex: 1; padding: 10px 0; margin: 0 4px; border: none; background: none; 
                   font-size: 0.95rem; font-weight: 600; cursor: pointer; color: var(--text-light);
                   border-bottom: 3px solid transparent; transition: all 0.3s; }
        .tab-btn:hover { color: var(--text); }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        
        /* --- Inneh√•ll Styling (Gemensamt f√∂r alla kalkylatorer) --- */
        .content-area { padding: 0 0 32px 0; }
        
        /* Header styling */
        .calc-header { background:linear-gradient(135deg,#667eea,#764ba2); color:white;
                 padding:30px 24px; text-align:center; position:relative; }
        h1 { font-size:1.8rem; font-weight:700; margin-bottom:8px; }
        .subtitle { font-size:0.9rem; opacity:0.9; }
        .tool-badge { position:absolute; top:16px; left:16px; padding:6px 14px;
                      border-radius:50px; font-size:0.8rem; font-weight:700;
                      text-transform:uppercase; letter-spacing:0.5px; }
        .tool-hm { background:var(--tool-hm); } 
        .tool-hss { background:var(--tool-hss); }
        
        /* Form och Input styling */
        main { padding:32px 24px; }
        .form-group { margin-bottom:20px; }
        label { display:block; margin-bottom:8px; font-weight:600; font-size:0.95rem; }
        select, input[type=number] { width:100%; padding:14px 16px; border:2px solid var(--border);
            border-radius:12px; background:var(--card); color:var(--text); font-size:1rem;
            transition:all .3s; }
        select:focus, input[type=number]:focus { outline:none; border-color:var(--primary);
            box-shadow:0 0 0 4px rgba(59,130,246,.15); transform:translateY(-2px); }
        .geometry-toggle { display:flex; gap:12px; margin:20px 0; }
        .geo-btn { flex:1; padding:14px; background:var(--border); color:var(--text-light);
                   text-align:center; border-radius:12px; cursor:pointer; font-weight:600;
                   transition:all .3s; }
        .geo-btn.active { background:var(--primary); color:white; }

        /* Resultat Styling - Planfr√§sning */
        .results { 
            margin-top: 32px; padding: 24px; background: #e9f7ff; border-radius: 14px; 
            border: 2px solid #b3e0ff; min-height: 120px; transition: all .4s; color: #1e293b;
        }
        body.dark .results { 
            background: #1e293b; border-color: #334155; color: #f1f5f9;
        }
        
        /* Resultat styling f√∂r Borrning/Fr√§sning */
        #content-area .results.ready { background:linear-gradient(to bottom,#ecfdf5,#d1fae5); border-color:#34d399; }
        body.dark #content-area .results.ready { background:linear-gradient(to bottom,#064e3b,#065f46); }

        .results h2 { font-size: 1.4rem; color: var(--success); margin-bottom: 20px; text-align: center; font-weight: 700; }
        .result-line { display: flex; justify-content: space-between; padding: 8px 0; font-size: 1.1rem; border-bottom: 1px dashed var(--border); }
        .result-line:last-child { border-bottom: none; }
        .result-line strong { font-weight: 600; color: var(--text); }
        .value { font-weight: 700; color: var(--text); }
        .big-vf { font-size: 1.4rem; color: var(--danger); font-weight: 800; } /* Planfr√§sning */
        .big { font-size:1.35rem; color:var(--danger); } /* Dynamisk Fr√§sning */
        .capped { color: var(--danger); }
        
        /* Detaljer */
        .details-box, .details {
            background: var(--card); border-radius: 10px; padding: 15px; margin-top: 20px;
            border: 1px solid var(--border); font-size: 0.9rem; line-height: 1.5;
            color: var(--text-light);
        }
        .details-box p, .details p { margin: 4px 0; display: flex; justify-content: space-between; }
        .details-box .detail-label, .details strong { font-weight: 500; color: var(--text-light); }
        .details-box .detail-value, .details p span.value { font-weight: 600; color: var(--text); }
        .warning-text { font-size:0.88rem; color:var(--warning); margin-top:12px; text-align:center; }
        .missing { color:var(--danger); font-weight:600; text-align:center; margin-top:10px; }
        .big-vc { font-size: 1.2rem; color: var(--text); font-weight: 700; }
    </style>
</head>
<body>

<div class="app-container">
    <button class="theme-toggle" id="themeToggle">üåô</button>
    
    <div class="tab-navigation" id="navigation">
        <button class="tab-btn" data-file="kalkylatorer/planfras.html">Planfr√§sning (Kappa/Runda)</button>
        <button class="tab-btn" data-file="kalkylatorer/borrning.html">Borrning</button>
        <button class="tab-btn" data-file="kalkylatorer/frasning.html">Dynamisk Fr√§sning</button>
    </div>
    
    <div id="content-area" class="content-area">
        <p style="text-align:center; padding:50px; color:var(--text-light);">Laddar kalkylator...</p>
    </div>
</div>

<script>
    // --- Flikhanteringslogik ---
    
    // Anv√§nds f√∂r att lagra init-funktioner fr√•n laddade scripts
    window.loadedCalculatorInit = [];

    async function loadCalculator(file) {
        const contentArea = document.getElementById('content-area');
        
        // 1. Rensa gamla scripts och rensa init-listan
        document.querySelectorAll('.loaded-script').forEach(s => s.remove());
        window.loadedCalculatorInit = [];
        contentArea.innerHTML = '<p style="text-align:center; padding:50px; color:var(--text-light);">Laddar...</p>';

        try {
            const response = await fetch(file);
            if (!response.ok) {
                if (response.status === 404) {
                    throw new Error(`Kalkylatorn kunde inte hittas. Kontrollera s√∂kv√§gen: ${file}`);
                }
                throw new Error('Kunde inte l√§sa in kalkylatorfilen.');
            }
            
            const fullHtml = await response.text();

            // Isolera HTML-inneh√•llet fr√•n scriptet
            const htmlContent = fullHtml.replace(/<script\b[^>]*>[\s\S]*?<\/script>/i, '');
            
            // Hitta scriptet med en tempor√§r div f√∂r att parsa HTML-str√§ngen
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = fullHtml;
            const scriptTag = tempDiv.querySelector('script');
            
            // 2. Injicera HTML
            contentArea.innerHTML = htmlContent;

            // 3. Injicera och Exekvera Scriptet
            if (scriptTag) {
                const newScript = document.createElement('script');
                newScript.textContent = scriptTag.textContent;
                newScript.classList.add('loaded-script'); // M√§rk scriptet
                document.body.appendChild(newScript);
            }
            
            // 4. Exekvera eventuell initieringslogik fr√•n det nyligen laddade scriptet
            window.loadedCalculatorInit.forEach(initFn => initFn());
            
        } catch (error) {
            contentArea.innerHTML = `<main style="padding: 32px 24px;"><p style="color:var(--danger); text-align:center;">Fel: ${error.message}</p></main>`;
        }
    }

    // Eventlyssnare f√∂r flikknapparna
    document.querySelectorAll('.tab-btn').forEach(button => {
        button.addEventListener('click', function() {
            // Markera aktiv flik
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // Ladda kalkylatorn
            const file = this.dataset.file;
            loadCalculator(file);
        });
    });

    // --- Tema-hantering (P√• huvudfilen) ---
    const themeToggle = document.getElementById('themeToggle');
    function initTheme() {
        // F√∂rst, kolla om anv√§ndaren har en inst√§llning lagrad
        let isDark = localStorage.getItem('theme') === 'dark';
        
        // Om ingen inst√§llning finns, kolla systeminst√§llningen
        if (localStorage.getItem('theme') === null) {
            isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        }

        document.body.classList.toggle('dark', isDark);
        themeToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
    }

    themeToggle.addEventListener('click', () => {
        document.body.classList.toggle('dark');
        const isDark = document.body.classList.contains('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        themeToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
    });

    // --- Startar Applikationen ---
    document.addEventListener('DOMContentLoaded', () => {
        initTheme(); // S√§tt tema f√∂rst
        
        // Ladda standardkalkylatorn (Planfr√§sning) vid sidladdning
        const defaultButton = document.querySelector('.tab-btn[data-file="kalkylatorer/planfras.html"]');
        if (defaultButton) {
            defaultButton.click();
        }
    });

</script>
</body>
</html>
